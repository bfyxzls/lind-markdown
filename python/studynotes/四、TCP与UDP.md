# TCP与UDP
**网络层中IP数据包首部有一个字段用来标识网络层的上一层，也就是传输层采用的是哪一种传输协议，根据这个字段，可以识别是TCP传输还是UDP传输；同样，传输层的TCP
和UDP为了识别自己的数据应该发送给哪一个应用程序，也设定了这样一个字段标识，这个字段标识就是端口号。（数据是从一个主机的应用程序发送给另一个主机的应用程序，
通过IP可以找到目标主机的位置，通过端口号可以确定数据应该给目标主机上的哪一个应用程序去使用。）**

**通信识别，TCP/IP,UDP/IP通信中通过五个信息来识别一个通信，“源IP地址”，“目标IP地址”，“源端口号”，“目标端口号”，“传输协议(TCP/UDP)”。这五个只要有一个不同，
就可认为是两个不同的通信。**
![](https://github.com/daacheng/PythonBasic/blob/master/pic/tcpudpport.png)
## 一、UDP
UDP传输不提供复杂的控制机制，它利用IP提供面向无连接的通信服务。UDP报文没有可靠性保证，顺序保证，和流量控制，可靠性比较差，传输过程中即使出现包丢失也不会重发。
也正是因为这些，它的资源消耗小，传输速度快，通常音频，视频在传送时用UDP传输较多。
## 二、TCP
TCP是一种面向有连接的传输协议，只有确认通信对端存在时，才会发送数据，从而可以控制通信流量的浪费。同时，TCP还充分实现数据传输过程中的各种控制，可以再数据丢包
的时候重发，还可以对次序乱掉的分包进行顺序控制。
## 三、TCP的特点
此处介绍TCP并没有详细介绍TCP的一些特性及传输实现过程，主要是大致了解TCP传输的一个过程，具体实现并没有深入了解。
### 3.1、连接管理
UDP是一种面向无连接的传输协议，不检查对端是否存在就直接把数据发送出去；TCP是面向有连接的传输协议，在进行数据传输之前，会先建立通信两端的连接。

**客户端通过TCP首部发送一个SYN包作为建立连接的请求，等待服务端确认应答，如果对端发送确认应答，则认为可以进行通信，如果客户端没有收到服务端的确认应答，则不会进行通信。在通信结束后，客户端还会发送FIN包做断开连接的处理，一个连接的建立与断开，正常需要来回发送七个包才能完成。**

#### 建立连接：
* 客户端发送SYN包到服务端，此时客户端进入SYN_SEND状态，等待服务端确认。
* 服务端收到客户端发送过来的SYN包，必须确认客户端的SYN包，同时自己也发送一个SYN包给客户端，即ACK+SYN,这时候服务端进入SYN_RECEIVED状态。
* 客户端接收到服务端的ACK+SYN包之后，向服务端发送确认应答包ACK，此包发送完毕，客户端与服务端进入ESTABLISHED状态，完成三次握手
#### 断开连接
* 客户端发送一个FIN包给服务端，用来关闭客户端到服务端数据传送。
* 服务端收到这个FIN包，就发送一个ACK确认应答给客户端。
* 服务端关闭与客户端之间的连接，发送FIN包给客户端。
* 客户端收到后，发送一个ACK应答给服务端，此时连接断开。
#### 为什么建立连接是三次，断开连接是四次
建立连接的三次通信过程，并没有开始传输数据，服务端接收客户端发送的SYN请求包后，把自己的确认包ACK和请求包SYN一起发送。
断开连接的过程中，客户端发送断开连接的请求，服务端接收到请求后，先发送确认包ACK，然后把还没有发送完的数据发送完之后，在发送FIN包，客户端在收到服务端的FIN之后，在发送ACK，连接断开。
断开连接过程中，为确保数据完整传输，服务端的ACK包和FIN包分开发送，所以建立连接是三次握手，断开连接是四次挥手。

![](https://github.com/daacheng/PythonBasic/blob/master/pic/tcpstatus.png)
### 3.2、通过序列号与确认应答提高传输可靠性
TCP传输协议，两台主机建立好连接之后，开始进行数据传输，当发送端的数据到达接收端，接收端会返回一个收到消息的应答，这个消息叫做确认应答ACK。
TCP通过确认应答ACK实现可靠的数据传输。

发送端将数据发送之后，会等待对方的确认应答，如果有确认应答，说明数据已经成功到达对端，反之，发送端在一定时间内没有收到ACK应答，就认为数据丢失，会重新
进行发送。

序列号是按照顺序给发送数据的每一个字节都标上号码的编号，接受端通过数据包首部中的序列号和数据长度，将自己下一次应该接收的数据的序列号作为确认应答发送给
发送端，这样，通过序列号和确认应答号，TCP可以实现可靠传输。
